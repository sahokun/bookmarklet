javascript:(async function(){function h(c){const a=document.querySelector(".ammSwapModal__balance"),b=document.createElement("p");b.textContent=`\u6700\u9069\u8cfc\u5165\u91cf: ${c}`;b.classList.add("optimal-purchase-amount");(c=a.querySelector("p.optimal-purchase-amount"))?c.textContent=b.textContent:a.prepend(b)}function k(){var c=document.querySelector(".ammSwapModal__token");if(!c)throw Error("\u7d20\u6750\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002");var a=c.querySelector("img").src.match(/\/(\d{3})\./);
a=a?a[1]:null;c=c.querySelector("p").textContent;console.log("3\u6841\u6570\u5b57:",a);console.log("p \u306e\u6587\u5b57:",c);return{materialId:parseInt(a),materialName:c}}async function l(c,a){console.log("\u7d20\u6750ID",c,"\u5e0c\u671b\u8cfc\u5165\u7d20\u6750\u91cf:",a);a:{for(b of m.tokenPricesMap)if(b[0]===c){var b=b[1].buyer.price;break a}b=null}console.log("\u73fe\u5728\u4fa1\u683c:",b);b=Math.ceil((Math.ceil(b*a)+1)/b*100)/100;console.log("\u4e0a\u9650\u7d20\u6750\u8cfc\u5165\u91cf:",b);var e=
(await $nuxt.$store.$laboratoryService.estimatePurchaseAmount(c,1E3*a)).amount;console.log("\u76ee\u6a19\u4fa1\u683c:",e);for(let f=0;10>f;f++){console.log("\u30eb\u30fc\u30d7\u56de\u6570:",f+1);console.log("\u4e0b\u9650:",a,"\u4e0a\u9650:",b,"\u76ee\u6a19:",e);var d=Math.ceil((a+b)/2*100)/100;console.log("\u4e2d\u9593\u5024:",d);let g=(await $nuxt.$store.$laboratoryService.estimatePurchaseAmount(c,1E3*d)).amount;console.log("\u4e2d\u9593\u5024\u306e\u4fa1\u683c:",g);g===e?(a=d,console.log("midPrice === targetPrice"),
console.log(`lowerBound${a} = mid${d}`)):(console.log("midPrice > targetPrice"),b=d,console.log(`upperBound${b} = mid${d}`));d=Math.ceil(1*d)/1E3;console.log(`tolerance: ${d}`);console.log(`(upperBound - lowerBound): ${b-a}, (0.01 + tolerance + EPSILON): ${.01+d+1E-10}`);console.log(b-a<=.01+d+1E-10);if(b-a<=.01+d+1E-10){console.log("\u4e0b\u9650\u3068\u4e0a\u9650\u304c\u96a3\u308a\u5408\u3063\u305f\u5834\u5408\u3001\u30eb\u30fc\u30d7\u7d42\u4e86");break}}console.log("\u8cfc\u5165\u53ef\u80fd\u91cf:",
a);return a}const m=await $nuxt.$store.$laboratoryService.getAllTokenPrices();try{const c=k(),a=prompt(`${c.materialName} \u5e0c\u671b\u8cfc\u5165\u91cf\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044:`);if(isNaN(a))throw Error("isNaN");const b=parseFloat(a);let e=await l(c.materialId,b);h(e);alert(`\u6700\u9069\u306a\u8cfc\u5165\u91cf: ${e}`)}catch(c){console.log(c),alert(`\u6700\u9069\u306a\u8cfc\u5165\u91cf\u7b97\u51fa\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\n\n${c.toString()}`)}})();
