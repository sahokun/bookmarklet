javascript:(async function(){function g(a){const b=document.querySelector(".ammSwapModal__balance"),c=document.createElement("p");c.textContent=`\u6700\u9069\u8cfc\u5165\u91cf : ${a}`;c.classList.add("optimal-purchase-amount");(a=b.querySelector("p.optimal-purchase-amount"))?a.textContent=c.textContent:b.prepend(c)}function h(){var a=document.querySelector(".ammSwapModal__token");if(!a)throw Error("getMaterial");var b=a.querySelector("img").src.match(/\/(\d{3})\./);b=b?b[1]:null;a=a.querySelector("p").textContent;
return{materialId:parseInt(b),materialName:a}}async function k(a,b){a:{for(c of l.tokenPricesMap)if(c[0]===a){var c=c[1].buyer.price;break a}c=null}c=Math.ceil((Math.ceil(c*b)+1)/c*100)/100;for(var d=(await window.$nuxt.$store.$laboratoryService.estimatePurchaseAmount(a,1E3*b)).amount,f=0;;){let e=Math.ceil((b+c)/2*100)/100;(await window.$nuxt.$store.$laboratoryService.estimatePurchaseAmount(a,1E3*e)).amount===d?b=e:c=e;if(Math.ceil(1E3*Math.abs(c-b))/1E3<=Math.ceil(1E3*(.001*e+.0100000001))/1E3)break;
if(9===f){alert("\u30eb\u30fc\u30d7\u4e0a\u9650\u8d85\u904e\u4e2d\u65ad");break}f++}return b}const l=await window.$nuxt.$store.$laboratoryService.getAllTokenPrices();try{const a=h(),b=prompt(`${a.materialName} \u5e0c\u671b\u8cfc\u5165\u91cf:`);if(isNaN(b))throw Error("isNaN");const c=parseFloat(b);let d=await k(a.materialId,c);g(d);alert(`\u6700\u9069\u8cfc\u5165\u91cf: ${d}`)}catch(a){console.log(a),alert(`\u5931\u6557\n\n${a.toString()}`)}})();
